import{createRouter as e,createWebHistory as t,createWebHashHistory as n,createMemoryHistory as r}from"vue-router";import{shallowRef as o}from"vue";const i={main:0},a=(e="main")=>{var t;const n=(null!==(t=i[e])&&void 0!==t?t:0)+1;return i[e]=n,n.toString()},s=(e,t)=>{let n={direction:void 0,action:void 0};t.afterEach(((e,t)=>{const{direction:r,action:o}=n,i=history.state.replaced?"replace":void 0;p(e,o||i,r),n={direction:void 0,action:void 0}}));const r=(()=>{const e=[],t={},n=t=>{const n=a(t.tab);n&&n.pop(),e.pop(),o(t)},r=t=>{const n=a(t.tab);let r;if(n){for(r=n[n.length-1];r&&r.id!==t.id;)n.pop(),r=n[n.length-1];n.pop(),n.push(t)}for(r=e[e.length-1];r&&r.id!==t.id;)e.pop(),r=e[e.length-1];e.pop(),e.push(t)},o=t=>{const n=a(t.tab);n&&(n[n.length-1]&&n[n.length-1].id===t.id&&n.pop(),n.push(t)),e.push(t)},i=()=>{e.length=0,Object.keys(t).forEach((e=>{t[e]=[]}))},a=e=>{let n;return e&&(n=t[e],n||(n=t[e]=[])),n},s=()=>e[e.length-1];return{current:s,previous:()=>e[e.length-2]||s(),add:e=>{switch(e.routerAction){case"replace":n(e);break;case"pop":r(e);break;default:o(e)}"root"===e.routerDirection&&(i(),o(e))},canGoBack:(t=1)=>e.length>t,update:n=>{const r=e.findIndex((e=>e.id===n.id));r>-1&&e.splice(r,1,n);const o=t[n.tab||""];if(o){const e=o.findIndex((e=>e.id===n.id));e>-1?o.splice(e,1,n):o.push(n)}else n.tab&&(t[n.tab]=[n])},getFirstRouteInfoForTab:e=>{const t=a(e);if(t)return t[0]},getCurrentRouteInfoForTab:e=>{const t=a(e);if(t)return t[t.length-1]},findLastLocation:t=>{const n=a(t.tab);if(n)for(let e=n.length-2;e>=0;e--){const r=n[e];if(r&&r.pathname===t.pushedByRoute)return r}for(let n=e.length-2;n>=0;n--){const r=e[n];if(r&&r.pathname===t.pushedByRoute)return r}}}})();let o,i,s,u=[];"undefined"!=typeof document&&document.addEventListener("ionBackButton",(t=>{t.detail.register(0,(t=>{e.history.go(-1),t()}))})),e.history.listen(((e,t,r)=>{n={action:r.type,direction:""===r.direction?"forward":r.direction}}));const c=(e,n,r,o,a)=>{i={routerAction:n,routerDirection:r,routerAnimation:o,tab:a},"push"===n?t.push(e):t.replace(e)},p=(e,t,n)=>{let c;c=i&&"replace"===i.routerAction?r.previous():r.current(),c||(c={pathname:"",search:""});if(c.pathname+c.search!==e.fullPath){if(!i){if("replace"===t)i={routerAction:"replace",routerDirection:"none",tab:s};else if("pop"===t){const e=r.current();if(e&&e.pushedByRoute){const t=r.findLastLocation(e);i=Object.assign(Object.assign({},t),{routerAction:"pop",routerDirection:"back"})}else i={routerAction:"pop",routerDirection:"none",tab:s}}i||(i={routerAction:"push",routerDirection:n||"forward",tab:s})}let u;if(null==i?void 0:i.id)u=Object.assign(Object.assign({},i),{lastPathname:c.pathname}),r.add(u);else{const t="push"===i.routerAction&&"forward"===i.routerDirection;if(u=Object.assign(Object.assign({id:a("routeInfo")},i),{lastPathname:c.pathname,pathname:e.path,search:e.fullPath&&e.fullPath.split("?")[1]||"",params:e.params&&e.params}),t)u.tab=c.tab,u.pushedByRoute=""!==c.pathname?c.pathname:void 0;else if("pop"===u.routerAction){const e=r.findLastLocation(u);u.pushedByRoute=null==e?void 0:e.pushedByRoute}else if("push"===u.routerAction&&u.tab!==c.tab){const e=r.getCurrentRouteInfoForTab(u.tab);u.pushedByRoute=null==e?void 0:e.pushedByRoute}else if("replace"===u.routerAction){const e=r.current();u.lastPathname=(null==e?void 0:e.pathname)||u.lastPathname,u.pushedByRoute=(null==e?void 0:e.pushedByRoute)||u.pushedByRoute,u.routerDirection=(null==e?void 0:e.routerDirection)||u.routerDirection,u.routerAnimation=(null==e?void 0:e.routerAnimation)||u.routerAnimation}r.add(u)}o=u}i=void 0,u.forEach((e=>e(o)))};return{handleNavigateBack:(e,n)=>{const o=r.current();if(o&&o.pushedByRoute){const a=r.findLastLocation(o);a?(i=Object.assign(Object.assign({},a),{routerAction:"pop",routerDirection:"back",routerAnimation:n||o.routerAnimation}),o.lastPathname===o.pushedByRoute?t.back():t.replace(a.pathname+(a.search||""))):c(e,"pop","back")}else c(e,"pop","back")},handleSetCurrentTab:e=>{s=e;const t=Object.assign({},r.current());t.tab!==e&&(t.tab=e,r.update(t))},getCurrentRouteInfo:()=>o,canGoBack:(e=1)=>r.canGoBack(e),navigate:e=>{const{routerAnimation:n,routerDirection:r,routerLink:o}=e;i={routerAnimation:n,routerDirection:r||"forward",routerAction:"push"},t.push(o)},resetTab:(e,n)=>{const o=r.getFirstRouteInfoForTab(e);if(o){const e=Object.assign({},o);e.pathname=n,i=Object.assign(Object.assign({},e),{routerAction:"pop",routerDirection:"back"}),t.push(e.pathname+(e.search||""))}},changeTab:(e,n)=>{const o=r.getCurrentRouteInfoForTab(e),[a]=n.split("?");if(o){const n=o.search?"?"+o.search:"";i=Object.assign(Object.assign({},i),{routerAction:"push",routerDirection:"none",tab:e}),o.pathname===a?t.push(o.pathname+n):t.push(a+n)}else c(a,"push","none",void 0,e)},registerHistoryChangeListener:e=>{u.push(e)}}};function u(e,t={}){const n=function(e){const t=[];let n=0;for(;n<e.length;){const r=e[n];if("*"!==r&&"+"!==r&&"?"!==r)if("\\"!==r)if("{"!==r)if("}"!==r)if(":"!==r)if("("!==r)t.push({type:"CHAR",index:n,value:e[n++]});else{let r=1,o="",i=n+1;if("?"===e[i])throw new TypeError('Pattern cannot start with "?" at '+i);for(;i<e.length;)if("\\"!==e[i]){if(")"===e[i]){if(r--,0===r){i++;break}}else if("("===e[i]&&(r++,"?"!==e[i+1]))throw new TypeError("Capturing groups are not allowed at "+i);o+=e[i++]}else o+=e[i++]+e[i++];if(r)throw new TypeError("Unbalanced pattern at "+n);if(!o)throw new TypeError("Missing pattern at "+n);t.push({type:"PATTERN",index:n,value:o}),n=i}else{let r="",o=n+1;for(;o<e.length;){const t=e.charCodeAt(o);if(!(t>=48&&t<=57||t>=65&&t<=90||t>=97&&t<=122||95===t))break;r+=e[o++]}if(!r)throw new TypeError("Missing parameter name at "+n);t.push({type:"NAME",index:n,value:r}),n=o}else t.push({type:"CLOSE",index:n,value:e[n++]});else t.push({type:"OPEN",index:n,value:e[n++]});else t.push({type:"ESCAPED_CHAR",index:n++,value:e[n++]});else t.push({type:"MODIFIER",index:n,value:e[n++]})}return t.push({type:"END",index:n,value:""}),t}(e),{prefixes:r="./"}=t,o=`[^${c(t.delimiter||"/#?")}]+?`,i=[];let a=0,s=0,u="";const p=e=>{if(s<n.length&&n[s].type===e)return n[s++].value},f=e=>{const t=p(e);if(void 0!==t)return t;const{type:r,index:o}=n[s];throw new TypeError(`Unexpected ${r} at ${o}, expected ${e}`)},d=()=>{let e,t="";for(;e=p("CHAR")||p("ESCAPED_CHAR");)t+=e;return t};for(;s<n.length;){const e=p("CHAR"),t=p("NAME"),n=p("PATTERN");if(t||n){let s=e||"";-1===r.indexOf(s)&&(u+=s,s=""),u&&(i.push(u),u=""),i.push({name:t||a++,prefix:s,suffix:"",pattern:n||o,modifier:p("MODIFIER")||""});continue}const s=e||p("ESCAPED_CHAR");if(s){u+=s;continue}u&&(i.push(u),u="");if(p("OPEN")){const e=d(),t=p("NAME")||"",n=p("PATTERN")||"",r=d();f("CLOSE"),i.push({name:t||(n?a++:""),pattern:t&&!n?o:n,prefix:e,suffix:r,modifier:p("MODIFIER")||""})}else f("END")}return i}function c(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function p(e){return e&&e.sensitive?"":"i"}function f(e,t,n){return function(e,t,n={}){const{strict:r=!1,start:o=!0,end:i=!0,encode:a=(e=>e)}=n,s=`[${c(n.endsWith||"")}]|$`,u=`[${c(n.delimiter||"/#?")}]`;let f=o?"^":"";for(const n of e)if("string"==typeof n)f+=c(a(n));else{const e=c(a(n.prefix)),r=c(a(n.suffix));if(n.pattern)if(t&&t.push(n),e||r)if("+"===n.modifier||"*"===n.modifier){const t="*"===n.modifier?"?":"";f+=`(?:${e}((?:${n.pattern})(?:${r}${e}(?:${n.pattern}))*)${r})${t}`}else f+=`(?:${e}(${n.pattern})${r})${n.modifier}`;else f+=`(${n.pattern})${n.modifier}`;else f+=`(?:${e}${r})${n.modifier}`}if(i)r||(f+=u+"?"),f+=n.endsWith?`(?=${s})`:"$";else{const t=e[e.length-1],n="string"==typeof t?u.indexOf(t[t.length-1])>-1:void 0===t;r||(f+=`(?:${u}(?=${s}))?`),n||(f+=`(?=${u}|${s})`)}return new RegExp(f,p(n))}(u(e,n),t,n)}function d(e,t,n){return e instanceof RegExp?function(e,t){if(!t)return e;const n=/\((?:\?<(.*?)>)?(?!\?)/g;let r=0,o=n.exec(e.source);for(;o;)t.push({name:o[1]||r++,prefix:"",suffix:"",modifier:"",pattern:""}),o=n.exec(e.source);return e}(e,t):Array.isArray(e)?function(e,t,n){const r=e.map((e=>d(e,t,n).source));return new RegExp(`(?:${r.join("|")})`,p(n))}(e,t,n):f(e,t,n)}const l=t=>{const n=Object.assign({},t);delete n.tabsPrefix;const r=e(n),i=s(t,r),u=(()=>{let e={};const t=(e,t)=>t.find((t=>{if(t.pathname===e)return t})),n=(n,r,o=!0)=>{const i=e=>{const t=n;return d(e.matchedRoute.path,[],{end:e.exact,strict:e.exact,sensitive:!1}).exec(t)?e:void 0};if(r){const a=e[r];if(!a)return;const s=t(n,a);if(s)return s;if(!o){const e=a.find(i);if(e)return e}}else for(let r in e){const o=e[r],i=t(n,o);if(i)return i}};return{clear:t=>{delete e[t]},findViewItemByRouteInfo:(e,t)=>n(e.pathname,t),findLeavingViewItemByRouteInfo:(e,t)=>n(e.lastPathname,t,!1),createViewItem:(e,t,n,r,i)=>({id:a("viewItem"),pathname:r.pathname,outletId:e,matchedRoute:n,ionPageElement:i,vueComponent:t,vueComponentRef:o(),ionRoute:!1,mount:!1,exact:r.pathname===n.path}),getChildrenToRender:t=>e[t]?e[t].filter((e=>e.mount)):[],add:t=>{const{outletId:n}=t;e[n]?e[n].push(t):e[n]=[t]},remove:(t,n)=>{if(!n)throw Error("outletId required");const r=e[n];r&&(e[n]=r.filter((e=>e.id!==t.id)))},registerIonPage:(e,t)=>{e.ionPageElement=t},getViewStack:t=>e[t]}})(),c=r.install.bind(r);r.install=e=>{e.provide("navManager",i),e.provide("viewStacks",u),c(e)};const p=r.isReady.bind(r);return r.isReady=()=>p(),r},h=e=>t(e),m=e=>n(e),g=e=>r(e);export{g as createMemoryHistory,l as createRouter,m as createWebHashHistory,h as createWebHistory};
//# sourceMappingURL=index.min.js.map
